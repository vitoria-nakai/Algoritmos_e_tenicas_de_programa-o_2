/*
Crie um programa que permita ao usuário cadastrar alunos (nome, idade e
nota) em um arquivo binário. O programa deve ter opções para adicionar
novos alunos, listar todos os alunos e buscar um aluno pelo nome.
*/

#include<stdio.h>
#include<stdlib.h>
#include<string.h>

int qtd = 0;

typedef struct{
    char nome[100];
    int idade;
    float nota;
} aluno;

void addAluno(aluno ** turma){
    
    char nome[100];
    int idade;
    float nota;
    
    *turma = realloc(*turma, sizeof(aluno) * (qtd + 1));
    
    printf("Digite o nome do(a) aluno(a): ");
    fgets(nome, sizeof(nome), stdin);
    nome[strcspn(nome, "\n")] = '\0';
    
    strcpy((*turma)[qtd].nome, nome);
    
    printf("Digite a idade do(a) aluno(a):");
    scanf("%d", &idade);
    getchar();
    
    (*turma)[qtd].idade = idade;
    
    printf("Digite a nota do(a) aluno(a): ");
    scanf("%f", &nota);
    getchar();
    
    (*turma)[qtd].nota = nota;
    
    qtd++;
}

void listamento(aluno * turma){
    
    printf("\n--- LISTA DE ALUNOS ---\n");
    
    for(int i = 0; i < qtd; i++){
        printf("ALUNO %d:\n", i + 1);
        printf("- Nome: %s\n", turma[i].nome);
        printf("- idade: %d anos\n", turma[i].idade);
        printf("- nota: %.2f\n\n", turma[i].nota);
    }
    
    printf("Fim do listamento.");
}

void buscaNome(aluno * turma){
    
    char nome[100];
    int indice = -1;
    
    printf("Qual o nome do aluno? ");
    fgets(nome, sizeof(nome), stdin);
    nome[strcspn(nome, "\n")] = '\0';
    
    
    for(int i = 0; i < qtd; i++){
        if(strcmp(turma[i].nome, nome) == 0){
            indice = i;
            break;
        };  
        
    }
    
    if(indice == -1){
        printf("O nome não está registrado. Tente novamente.");
        return;
    } else {
        printf("\nALUNO %d\"", indice + 1);
        printf("\n- nome: %s", turma[indice].nome);
        printf("\n- idade: %d anos", turma[indice].idade);
        printf("\n- nota: %.2f", turma[indice].nota);
    };
    
}

int main(){
    
    int op = 1;
    aluno * turmaA = (aluno*)malloc(sizeof(aluno));
    
    while(op != 0){
        printf("--------------------SISTEMA DE CADASTRO DE ALUNOS--------------------\n\n");
        printf("OPERAÇÕES:\n");
        printf("1 - Adicionar novo aluno\n");
        printf("2 - Listar todos os alunos cadastrados\n");
        printf("3 - Busca das informações de certo aluno\n");
        printf("0 - Desligar o sistema\n");
        printf("Digite o respectivo número da operação que deseja realizar: ");
        scanf("%d", &op);
        getchar();
        
        if(op == 1) addAluno(&turmaA);
        else if(op == 2) listamento(turmaA);
        else if(op == 3) buscaNome(turmaA);
        else if(op == 0){
            FILE * alunosA = fopen("alunosA.bin", "wb");
            fwrite(turmaA, sizeof(aluno), qtd, alunosA);
            fclose(alunosA);
        } else printf("Dígito sem operação. Tente de novo.");
    }
    
    return 0;
}
